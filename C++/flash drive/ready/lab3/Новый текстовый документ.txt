#include <stdio.h>
#include <stdlib.h>
#include <fstream>
#include <iostream>
#include <conio.h>
#include <io.h>
using namespace std;
struct SCAN_INFO
{
	char manufacturer[127];// изготовитель
	int year;	 // год изготовления
	char model[128];// наименование модели
	float price;// цена
	int x_size;// горизонтальный размер области сканирования
	int y_size;// вертикальный размер области сканирования
	int optr; // оптическое разрешение
};

int main()
{
    SCAN_INFO p, t;
	strcpy(p.manufacturer,"lkklpk");
	cout<<"adds data into the file (ENTER)"<<endl;
	cout<<"displays contents of the file (1)"<<endl;
	cout<<"exit (ESC)"<<endl;
	ofstream in("Scaners.dba",ios::trunc);
	in.close();	
	int menu=0,n=0; bool b;

	while (menu!=27)
	{
		menu=getch();
		if (menu==13)
		{	
			cout<<"Manufacturer: ";	cin>>p.manufacturer;
			cout<<"Year: ";	cin>>p.year;
			b=0;
			/*ifstream in("Scaners.dba",ios::binary|ios::in);
			in.seekg( 0, std::ios::end );
			int size = in.tellg();
			if (size>0)
			{ in.read((char*)&n,sizeof n);
			  for (int i=0;i<n;i++)
			  { 
				in.read((char*)&t,sizeof t);
				cout<< t.manufacturer;
				if (strcmp(p.manufacturer,t.manufacturer)==0)
				{
					b=1;
					break;
				}
				cout<<"  "  <<b<<endl;
			  }
			  in.close();*/
				
				FILE *in;
				if ((in=fopen("Scaners.dba", "rb"))!=NULL)
			{
				fread(&n, sizeof n, 1, in);
				 for (int i=0;i<n;i++)
			      { 
				  fread(&t, sizeof t, 1, in);
			    	cout<< t.manufacturer;
			    	if (strcmp(p.manufacturer,t.manufacturer)==0)
			     	{
					b=1;
					break;
			    	}
				  cout<<"  "  <<b<<endl;
			     }
		    	 fclose(in);
		
			 
			 if(b==0)
			 {n++;
			 FILE *f1;
			 f1 = fopen("Scaners.dba", "r+b");
			 fwrite(&n, sizeof n, 1, f1);
			 fseek(f1, 0L, SEEK_END);
			 fwrite(&p, sizeof p, 1, f1);
			 fclose(f1);
			 }
			 else cout<<"Exists"<<endl;
			}// size>0
			else
			{ofstream fwr("Scaners.dba",ios_base::app|ios_base::binary);
				n=1;
			    fwr.write((char*)&n,sizeof n);
				fwr.write((char*)&p,sizeof p); 
				fwr.close();
			
			}
		}// end ENTER
		else
			if(menu==49)
			{
				cout<<"----------FILE CONTENTS:----------"<<endl;
				ifstream in("Scaners.dba",ios::binary|ios::in);//ifstream fread("Scaners.dba",ios_base::in);
				in.read((char*)&n,sizeof n);

				for (int i=0;i<n;i++)
				{ 
				in.read((char*)&t,sizeof t);
				cout<<t.manufacturer<<" | "<<t.year<<endl;
				}
				in.close();
				cout<<"OK"<<endl;
			}	
	}
	
	cin.get();
}